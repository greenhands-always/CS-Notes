#MYSQL #数据库 
只会包含一些要点和特殊点，不包含知识体系

---
# 1 什么是 SQL
从技术层面,SQL并不是一门单一语言,而是一些东西的集合,包括:
- Data Manipulation Language (DML) :主要是select,insert,delete这些操作
	1. 过程化DML
	2. 声明式DML
- Data Definition Language (DDL):定义schema来创建表存储数据
%%数据库系统所使用的==存储结构和访问方式==是通过一系列特殊的DDL语句来说明的，这种特殊的DDL称作数据存储和定义(datastorage and definition)语言C这些语句定义了数据库模式的实现细节，而这些细节对用户来说通常是不可见的。
约束类别:
- 域约束
- 参照完整性 
- 断言
- 授权
%%
- Data Control Language(DCL):安全授权,负责权限控制
- 其他: 诸如视图、完整性、事务等特性

SQL实际上是基于bag algebra的，可以有重复的元素

---
# 2 文件系统主要弊端
## 2.1 数据的冗余和不一致(dataredundancy and inconsistency)。
%%由于文件和程序是在很长的一段时间内由不同的程序员创建的，不同文件可能有不同的结构，不同程序可能采用不同的程序设计语言写成。此外，相同的信息可能在几个地方（文件）重复存储。例如，如果某学生有两个专业（例如，音乐和数学），该学生的地址和电话号码就可能既出现在包含音乐系学生记录的文件中，又出现在包含数学系学生记录的文件中。这种冗余除了导致存储和访问开销增大外，还可
能导致数据不一致性(datainconsistency)，即同一数据的不同副本不一致。例如，学生地址的更
改可能在音乐系记录中得到反映而在系统的其他地方却没有。%%
## 2.2 ·数锯访问固难(difficulty in accessing data)。
## 2.3 ·数据孤立(dataisolation)。
## 2.4 ·完整性问题(integrityproblem)。
%%数据库中所存储数据的值必须满足某些特定的一致性约束
(consistency constraint)。假设大学为每个系维护一个账户，并且记录各个账户的余额。我们还
假设大学要求每个系的账户余额永远不能低于零。开发者通过在各种不同应用程序中加入适当
的代码来强制系统中的这些约束。然而，当新的约束加人时，很难通过修改程序来体现这些新
的约束。尤其是当约束涉及不同文件中的多个数据项时，问题就变得更加复杂了。%%
## 2.5 ·原子性问题(atomicity problem)。
%%如同任何别的设备一样，计算机系统也会发生故障。一旦故障
发生，数据就应被恢复到故障发生以前的一致的状态，对很多应用来说，这样的保证是至关重仁互］
要的。让我们看看把A系的账户余额中的500美元转入B系的账户余额中的这样一个程序。假
设在程序的执行过程中发生了系统故障，很可能A系的余额中减去的500美元还没来得及存入
B系的余额中，这就造成了数据库状态的不一致。显然，为了保证数据库的一致性，这里的借
和贷两个操作必须是要么都发生，要么都不发生。也就是说，转账这个操作必须是原子的一一
它要么全部发生要么根本不发生。在传统的文件处理系统中，保持原子性是很难做到的。%%
## 2.6 ·井发访问异常(concurrent-accessanomaly)。
%%为了提高系统的总体性能以及加快响应速度，许多
系统允许多个用户同时更新数据。实际上，如今最大的互联网零售商每天就可能有来自购买者
对其数据的数百万次访问。在这样的环境中，并发的更新操作可能相互影响，有可能导致数据
的不一致。设A系的账户余额中有10000美元，假如系里的两个职员几乎同时从系的账户中取
款（例如分别取出500美元和100美元），这样的并发执行就可能使账户处千一种错误的（或不
一致的）状态。假设每个取款操作对应执行的程序是读取原始账户余额，在其上减去取款的金
额，然后将结果写回。如果两次取款的程序并发执行，可能它们读到的余额都是IO000美元，
并将分别写回9500美元和9900美元。A系的账户余额中到底剩下9500美元还是9900美元视
哪个程序后写回结果而定，而实际上正确的值应该是9400美元。为了消除这种情况发生的可
能性，系统必须进行某种形式的管理。但是，由千数据可能被多个不同的应用程序访问，这些
程序相互间事先又没有协调，管理就很难进行。
作为另一个例子，假设为确保注册一门课程的学生人数不超过上限，注册程序维护一个注
册了某门课程的学生计数。当一个学生注册时，该程序读人这门课程的当前计数值，核实该计
数还没有达到上限，给计数值加I,将计数存回数据库。假设两个学生同时注册，而此时的计
数值是（例如）39。尽管两个学生都成功地注册了这门课程，计数值应该是41,然而两个程序
执行可能都读到值39,然后都写回值40,导致不正确地只增加了1个注册人数。此外，假设该
课程注册人数的上限是40;在上面的例子中，两个学生都成功注册，就导致违反了40个学生
为注册上限的规定。%%
## 2.7 ·安全性问题(securityproblem)。
%%并非数据库系统的所有用户都可以访问所有数据。例如在大学中，
工资发放人员只需要看到数据库中关千财务信息的那个部分。他们不需要访问关千学术记录的信息。
仁汇］但是，由于应用程序总是即席地加入到文件处理系统中来，这样的安全性约束难以实现。
以上问题以及一些其他问题，促进了数据库系统的发展。接下来我们将看一看数据库系统为了解
决上述在文件处理系统中存在的问题而提出的概念和算法。在本书的大部分篇幅中，我们在讨论典型
的数据处理应用时总以大学作为实例。%%

---

# 3 数据视图
## 3.1 数据抽象
> 物理层 (physicallevel)。最低层次的抽象，描述数据实际上是怎样存储的。物理层详细描述复杂的底层数据结构。
> 逻辑层 (logicallevel)。比物理层层次稍高的抽象，描述数据库中存储什么数据及这些数据间存在什么关系。这样逻辑层就通过少量相对简单的结构描述了整个数据库。虽然逻辑层的简单结构的实现可能涉及复杂的物理层结构，但逻辗层的用户不必知道这样的复杂性。这称作物理数据独立性 (physicaldataindependence)。数据库管理员使用抽象的逻辑层，他必须确定数据库中应该保存哪些信息。
> 视图层 (viewlevel)。最高层次的抽象，只描述整个数据库的某个部分。尽管在逻辑层使用了比较简单的结构，但由千一个大型数据库中所存信息的多样性，仍存在一定程度的复杂性。数据库系统的很多用户并不需要关心所有的信息，而只需要访问数据库的一部分。视图层抽象的定义正是为了使这样的用户与系统的交互更简单。系统可以为同一数据库提供多个视图。
>  %%[013页](bookxnotepro://opennote/? nb={c99b0202-1308-4335-acc3-f0dd1e5bc7cc}&book=7a0a8f7d2262490080890f4e7c4f5ca2&page=12&x=196&y=266&id=3&uuid=f5065e9dde83ee6ea462bec21c8225cd)%%
## 3.2 数据模型
- 关系模型
- 实体-联系模型 (ER)
- 基于对象的数据模型
- 半结构化数据模型


# 4 数据存储与查询
## 4.1 存储管理器
存储管理部件包括：
1. 权限及完整性管理器 (authorizationandintegritymanager)，它检测是否满足完整性约束，并检查试图访问数据的用户的权限。
2. 事务管理器 (transactionmanager)，它保证即使发生了故障，数据库也保持在一致的（正确的）状态，并保证并发事务的执行不发生冲突。
3. 文件管理器 (filemanager), 它管理磁盘存储空间的分配，管理用于表示磁盘上所存储信息的数据结构。
4. 缓冲区管理器 (buffermanager)，它负责将数据从磁盘上取到内存中来，并决定哪些数据应被缓冲存储在内存中。缓冲区管理器是数据库系统中的一个关键部分，因为它使数据库可以处理比内存更大的数据。 %%[021页](bookxnotepro://opennote/? nb={c99b0202-1308-4335-acc3-f0dd1e5bc7cc}&book=7a0a8f7d2262490080890f4e7c4f5ca2&page=20&x=194&y=244&id=8&uuid=a022587aa7fd96ac70d3e44afdaa6458)%%
存储管理器实现了几种数据结构，作为系统物理实现的一部分：
1. ·数据文件 (datafiles)，存储数据库自身。
2. ·数据字典 (datadictionary)，存储关千数据库结构的元数据，尤其是数据库模式。
3. ·索引 (index)，提供对数据项的快速访问。和书中的索引一样，数据库索引提供了指向包含特定值的数据的指针。例如，我们可以运用索引找到具有特定的 ID 的，instructor 记录，或者具有特定的 name 的所有 instructor 记录。散列是另外一种索引方式，在某些情况下速度更快，但不是在所有情况下都这样。 %%[021页](bookxnotepro://opennote/? nb={c99b0202-1308-4335-acc3-f0dd1e5bc7cc}&book=7a0a8f7d2262490080890f4e7c4f5ca2&page=20&x=194&y=330&id=10&uuid=355fa5b634a98df94b03f607fda4c333)%%

## 4.2 查询处理器
1. DDL 解释器 (DDLinterpreter)，它解释 DDL 语句并将这些定义记录在数据字典中。
2. DML 编译器 (DMLcompiler)，将查询语言中的 DML 语句翻译为一个执行方案，包括一系列查询执行引擎能理解的低级指令。一个查询通常可被翻译成多种等价的具有相同结果的执行方案的一种。DML 编译器还进行查询优化 (queryoptimization)，也就是从几种选择中选出代价最小的一种。
3. 查询执行引擎 (queryevaluationengine)，执行由 DML 编译器产生的低级指令。 %%[021页](bookxnotepro://opennote/? nb={c99b0202-1308-4335-acc3-f0dd1e5bc7cc}&book=7a0a8f7d2262490080890f4e7c4f5ca2&page=20&x=177&y=440&id=11&uuid=9aa809d052fe38874454657baec2bbb9)%%
# 5 事务管理
事务 (transaction)是数据库应用中完成单一逻辑功能的操作集合。每一个事务是一个既具==原子性==又具==一致性==的单元。因此，我们要求事务不违反任何的数据库一致性约束，也就是说，如果事务启动时数据库是一致的，那么当这个事务成功结束时数据库也应该是一致的。然而，在事务执行过程中，必要时允许暂时的不一致，因为无论是 A 取出的操作在前还是 B 存入的操作在前，这两个操作都必然有一个先后次序。这种暂时的不一致虽然是必需的，但在故障发生时，很可能导致问题的产生。 %%[022页](bookxnotepro://opennote/? nb={c99b0202-1308-4335-acc3-f0dd1e5bc7cc}&book=7a0a8f7d2262490080890f4e7c4f5ca2&page=21&x=189&y=141&id=12&uuid=bda53d60e9de7a73924eb8cea645ac9f)%%
原子性和持久性的保证是数据库系统自身的职责，确切地说，是恢复管理器 (recovery manager)的职责。在没有故障发生的情况下，所有事务均成功完成，这时要保证原子性很容易。但是，由于各种互汇］各样的故障，事务并不总能成功执行完毕。为了保证原子性，失败的事务必须对数据库状态不产生任何影响。因此，数据库必须被恢复到该失败事务开始执行以前的状态。这种情况下数据库系统必须进行故障恢复 (failurerecovery), 即检测系统故障并将数据库恢复到故障发生以前的状态。 %%[022页](bookxnotepro://opennote/? nb={c99b0202-1308-4335-acc3-f0dd1e5bc7cc}&book=7a0a8f7d2262490080890f4e7c4f5ca2&page=21&x=199&y=239&id=13&uuid=c0aa8926338b820ee7fd90fabdb6053e)%%
当多个事务同时对数据库进行更新时，即使每个单独的事务都是正确的，数据的一致性也可能被破坏。井发控制管理器(concurrency-controlmanager)控制并发事务间的相互影响，保证数据库一致性。事务管理器(transactionmanager)包括并发控制管理器和恢复管理器。 %%[022页](bookxnotepro://opennote/?nb={c99b0202-1308-4335-acc3-f0dd1e5bc7cc}&book=7a0a8f7d2262490080890f4e7c4f5ca2&page=21&x=189&y=280&id=14&uuid=1c8f786c199e4558be892bfc2b2e5367)%%

# 6 Aggregation
常见函数：
- AVG(co1)
- MIN(co1)
- MAX(co1)
- SUM(co1)
- COUNT(co1)
聚合只能用在select的输出字句中。
下面给出聚合函数的例子，不同col性能不同，对于调优很有必要了解这些![](https://obsidian-notes-of-huangyh.oss-cn-hangzhou.aliyuncs.com/img/20230126225510.png)







